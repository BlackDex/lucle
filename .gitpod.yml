image: gitpod/workspace-full
checkoutLocation: gitpod-k3s
tasks:
  - before: |
      curl -LO https://github.com/protocolbuffers/protobuf/releases/download/v3.21.12/protoc-3.21.12-linux-x86_64.zip
      unzip protoc-3.21.12-linux-x86_64.zip -d $HOME/.local
      export PATH="$PATH:$HOME/.local/bin"
  - init: cargo build
    command: cargo watch -x run  
  - name: prepare k3s
    command: |
      .gitpod/prepare-k3s.sh
  - name: kernel dev environment
    init: |
      sudo apt update -y
      sudo apt upgrade -y
      sudo apt update -y
      sudo apt install qemu qemu-system-x86 linux-image-generic libguestfs-tools sshpass netcat -y
      .gitpod/prepare-rootfs.sh
    command: |
      .gitpod/qemu.sh


