syntax = "proto3";

package luclerpc;

service Lucle {
  rpc create_db (Database) returns (ResponseResult);
  rpc delete_db (Database) returns (ResponseResult);
  rpc login (User) returns (ResponseResult);
  rpc create_user (User) returns (ResponseResult);
  rpc is_created_user (Database) returns (ResponseResult);
  rpc create_table (Database) returns (Empty);
  rpc forgot_password (User) returns (ResponseResult);
  rpc ServerStreamingEcho (Empty) returns (stream Message);
}

service Repo {
  rpc init (RepositoryPath) returns (ResponseResult);
  rpc status (RepositoryPath) returns (stream StatusResult);
  rpc set_current_version (Version) returns (ResponseResult);
  rpc register_version (Version) returns (ResponseResult);
  rpc unregister_version (Version) returns (ResponseResult);
  rpc register_package (Package) returns (ResponseResult);
  rpc unregister_package (Package) returns (ResponseResult);
}

message RepositoryPath {
  string path = 1;
}

message ResponseResult {
  string error = 1;
}

message StatusResult {
  bool repoinit = 1;
  string current_version = 2;
  repeated string versions = 3;
  repeated string packages = 4;
}

message Version {
  string path = 1;
  string version = 2;
}

message Package {
  string path = 1;
  string name = 2;
}

enum DatabaseType {
  MYSQL = 0 ;
  POSTGRESQL = 1 ;
  SQLITE = 2 ;
}

message Database {
  DatabaseType db_type = 1;
  optional string db_name = 2;
  optional string migration_path = 3;
  optional string username = 4;
  optional string password = 5;
  optional string hostname = 6;
  optional string port = 7;
}

message User {
  string database_path = 1;
  string username = 2;
  string password = 3;
  optional string email = 4;
}

message Message {
  string plugin = 1;
}

message Empty {}
